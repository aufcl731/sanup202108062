{% extends "base/base.html" %}
{% load staticfiles %}

{% block staticfile %}
<link rel="stylesheet" href="{% static 'css/setting.css' %}">
<script type="text/javascript" src="{% static 'js/setting.js' %}"></script>
<script type="text/javascript">

    window.onload = function(){
        var aa='{{ jsonList }}';
        console.log(aa);
        /*
        $.ajax({
            url:'http://www.kma.go.kr/DFSROOT/POINT/DATA/top.json.txt',
            type: 'GET',
            cache:false,
            //data:{},
            dataType:'jsonp',
            jsonp : "callback",
            async: false,
            success: function(res){
                console.log('aa');
            },
            error: function(jqXHR, exception){
                        if (jqXHR.status === 0) {
            alert('Not connect.\n Verify Network.');
        }
        else if (jqXHR.status == 400) {
            alert('Server understood the request, but request content was invalid. [400]');
        }
        else if (jqXHR.status == 401) {
            alert('Unauthorized access. [401]');
        }
        else if (jqXHR.status == 403) {
            alert('Forbidden resource can not be accessed. [403]');
        }
        else if (jqXHR.status == 404) {
            alert('Requested page not found. [404]');
        }
        else if (jqXHR.status == 500) {
            alert('Internal server error. [500]');
        }
        else if (jqXHR.status == 503) {
            alert('Service unavailable. [503]');
        }
        else if (exception === 'parsererror') {
            alert('Requested JSON parse failed. [Failed]');
        }
        else if (exception === 'timeout') {
            alert('Time out error. [Timeout]');
        }
        else if (exception === 'abort') {
            alert('Ajax request aborted. [Aborted]');
        }
        else {
            alert('Uncaught Error.n' + jqXHR.responseText);
        }
            }
        });*/
    };

    function setAddress() {
        var value = $('#bottomAddress').val().split(' ');

        if($('.newX'))
            $('.newX').remove();
        if($('.newY'))
            $('.newY').remove();

        var x = value[0];
        var y = value[1];

        console.log('x: ' + x + 'y: ' + y);

        $('#cif').append('<input class="newX" type="hidden" name="x" value="' + x + '">');
        $('#cif').append('<input class="newY" type="hidden" name="y" value="' + y + '">');
    }

    function changeAddress(type) {
        var code = '';
        if(type == 1)
            code = $('#topAddress').val();
        else if(type == 2)
            code = $('#midAddress').val();

        $.ajax({
            url:'/setting/getAddress',
            type: 'POST',
            cache:false,
            data:{
                type: type,
                code: code
            },
            dataType:'json',
            async: false,
            success: function(res){
                console.log(res);
                if(res.type == 1){
                    $('#midAddress > .new').remove();
                    res.addressList.forEach(function (addressObj) {
                        $('#midAddress').append('<option class="new" value="' +  addressObj.code + '">' + addressObj.value + '</option>');
                    });
                }else if(res.type == 2){
                    $('#bottomAddress > .new').remove();
                    res.addressList.forEach(function (addressObj) {
                        $('#bottomAddress').append('<option class="new" value="' +  addressObj.x + ' ' + addressObj.y + '">' + addressObj.value + '</option>');
                    });
                }
            },
        });
    }


</script>
{% endblock staticfile %}

{% block content %}
            <div id="settingContentWrap">
                <h3 id="settingHeadLine">User Settings</h3>
                <div id="settingWrap" class="fix">
                    <div>
                        <form action="/setting/changePassword" method="POST" name="cpf">{% csrf_token %}
                            <div class="line">
                                <p>비밀번호</p>
                                <input type="password" name="password" id="password">
                            </div>
                            <div class="line">
                                <p>새 비밀번호</p>
                                <input type="password" name="change_password" id="change_password">
                            </div>
                            <div class="line">
                                <p>새 비밀번호 확인</p>
                                <input type="password" name="confirm_password" id="confirm_password">
                            </div>
                            <div class="line">
                                <button>저장</button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <form action="/setting/changeUserInfo" method="POST" name="uif" enctype="multipart/form-data">{% csrf_token %}
                            <div class="line">
                                <p>사용자 이름</p>
                                <input type="text" value="{{ user.name }}" name="user_name" id="user_name">
                            </div>
                            <div class="line">
                                <p>사용자 이메일</p>
                                <input type="email" value="{{ user.email }}" name="user_email" id="user_email">
                            </div>
                            <div class="line">
                                <p>사용자 프로필</p>
                                {% if user.propic %}
                                    <div class="settingPropic"><img src="{{ user.propic.url }}"width="80px"></div>
                                {% else %}
                                    <div><img src="/static/image/ningen.png"width="80px"></div>
                                {% endif %}
                                <input type="file" name="user_propic" id="user_propic">
                            </div>
                            <div class="line">
                                <button>저장</button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <div class="line">
                            <p>알림 기능</p>
                            <div id="themeTap" class="fix">
                                <div>
                                    <div>
                                        <input type="radio" name="color_theme"><span>주문</span>
                                    </div>
                                    <div>
                                        <input type="radio" name="color_theme"><span>디자인</span>
                                    </div>
                                </div>
                                <div>
                                    <div>
                                        <input type="radio" name="color_theme"><span>신규회원</span>
                                    </div>
                                    <div>
                                        <input type="radio" name="color_theme"><span>기계</span>
                                    </div>
                                </div>
                            </div>
                            <div class="submit-btn">
                                <span><button onclick="alramchange()">저장</button></span>
                            </div>
                            <div class="line">
                                <p>언어</p>
                                <input type="radio" name="lang_theme"><span>한글</span>
                                <input type="radio" name="lang_theme"><span>영어</span>
                            </div>
                            <div class="line">
                               <button>저장</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% if user.is_superuser %}
                <div id="companySettingWrap">
                    <h3 id="companyHeadLine">Company Settings</h3>
                    <div>
                        <form action="/setting/companyInfo" method="POST" name="cif" id="cif">{% csrf_token %}
                            <div class="line">
                                <p>회사명 등록</p>
                                <input type="text" name="company" id="company" value="{{ company.name }}">
                            </div>
                            <div class="line">
                                <p>회사코드</p>
                                <input type="text" name="company_code" id="company_code" value="{{ company.code }}">
                            </div>
                            <div class="line">
                                <p>회사주소</p>
                                <select id="topAddress" onchange="changeAddress(1)">
                                    <option>선택해주세요</option>
                                    {% for addressObj in addressList %}
                                        <option value="{{ addressObj.code }}">{{ addressObj.value }}</option>
                                    {% endfor %}
                                </select>
                                <select id="midAddress" onchange="changeAddress(2)">
                                    <option>선택해주세요</option>
                                </select>
                                <select id="bottomAddress" onchange="setAddress()">
                                    <option>선택해주세요</option>
                                </select>
                            </div>
                            <div class="line">
                                <p>기계사용</p>
                                <input type="radio" name="machineyn" value="1"><span class="machineUse">사용</span>
                                <input type="radio" name="machineyn" value="2"><span>사용안함</span>
                            </div>
                            <div class="line">
                               <button>저장</button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <form action="/setting/createDepartment" method="POST" name="cif" id="cif">{% csrf_token %}
                            <div class="line">
                                <p>부서명 등록</p>
                                <input type="text" autocomplete="off" name="department" id="department">
                            </div>
                            <div class="line">
                                <p>부서리스트</p>
                                <select id="departmentList" size="5">
                                    {% for department in departmentList %}
                                        <option value="{{ department.id }}">{{ department.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="line">
                               <button>저장</button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <div class="userLine">
                            <p>유저 리스트</p>

                            <!-- User List -->
                            <div id="userListWrap">
                                {% for userInfo in userList %}
                                <div class="userList fix">
                                    <div class="propicBox">
                                        {% if userInfo.propic %}
                                        <img src="{{ userInfo.propic.url }}" width="100px">
                                        {% else %}
                                        <img src="{% static 'image/ningen.png' %}" width="100px">
                                        {% endif %}
                                    </div>
                                    <div class="userInfo">
                                        <h3>{{ userInfo.name }}({{ userInfo.username }})</h3>
                                        <div class="uLine">
                                            <span>E-mail</span>
                                            <span>{{ userInfo.email }}</span>
                                        </div>
                                        <div class="uLine">
                                            <span>Sign up Date</span>
                                            <span>{{ userInfo.create_date|date:"Y-m-d" }}</span>
                                        </div>
                                        <div class="uLine">
                                            <span>Section</span>
                                            <span>{{ userInfo.group_code.name }}</span>
                                        </div>
                                        <div class="uLine">
                                            {% if userInfo.is_active == True %}
                                            <span class="userState">사용중</span>
                                            {% else %}
                                            <span class="uerState stateBtn" onclick="activeUser({{ userInfo.id }})">수락</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                            <!-- Usre End -->


                        </div>
                    </div>
                </div>
                {% endif %}
            <form action="/order/modify" method="POST" name="modifyOrderForm" id="modifyOrderForm">{% csrf_token %}
            <div id="detailOrderModal">
                <div>
                    <h3>오더 상세보기</h3>
                </div>
                <div class="inputTab fix">
                    <div>
                        <div class="line">
                            <label for="detailCompany">사업장</label>
                            <input type="text" disabled id="detailCompany" name="detailCompany">
                        </div>
                        <div class="line">
                            <label for="detailBuyer">거래처</label>
                            <input type="text" id="detailBuyer" name="detailBuyer">
                        </div>
                        <div class="line">
                            <label for="detailManager">담당자</label>
                            <input type="text" id="detailManager" name="detailManager">
                        </div>
                        <div class="line">
                            <label for="detailOrderDate">오더일자</label>
                            <input type="date" id="detailOrderDate" name="detailOrderDate">
                        </div>

                    </div>
                    <div>
                        <div class="line margin_exempt">
                            <label for="detailOrderType">오더구분</label>
                            <select name="detailOrderType" id="detailOrderType" class="justselect2">

                            </select>
                        </div>
                        <div class="line margin_exempt">
                            <label for="detailOrderInout">내외구분</label>
                            <select name="detailOrderInout" id="detailOrderInout" class="justselect2">

                            </select>
                        </div>
                        <div class="line">
                            <label for="detailRound">차수</label>
                            <input type="text" id="detailRound" name="detailRound">
                        </div>
                        <div class="line">
                            <label for="detailDueDate">납기일</label>
                            <input type="date" id="detailDueDate" name="detailDueDate">
                        </div>
                    </div>
                    <div class="orderDesignDetail">
                        <div class="fix">
                            <div id="subDesignImgBox">
                                <label class="subLabel">시뮬레이션 이미지</label>
                                <span><img src="{% static 'image/simulation_img.jpg' %}" width="200px"></span>
                            </div>
                            <div id="subDesignInfo">
                                <div id="subOrderWrap" class="subLine">
                                    <label class="subLabel" for="subOrderCode">서브오더</label>
                                    <select name='subOrderCode' id='subOrderCode' class='justselect2'>
                                    </select>
                                </div>
                                <div class="subLine">
                                    <label class="subLabel" for="subDesign">디자인명</label>
                                    <input type="text" disabled id="subDesign" name="subDesign">
                                </div>
                                <div class="subLine lastSubLine">
                                    <label for="subDesignQty" class="subLabel">수량</label>
                                    <input type="text" id="subDesignQty" name="subDesignQty">
                                </div>
                                <input type="hidden" id="oid" name="oid">
                                <!--
                                <div class="subLine subLine_exempt">
                                    <label class="subLabel">WPI</label>
                                    <input type="text">
                                </div>
                                <div class="subLine">
                                    <label class="subLabel">CPC</label>
                                    <input type="text">
                                </div>
                                <div class="subLine">
                                    <label class="subLabel">Width</label>
                                    <input type="text">
                                </div>
                                -->
                            </div>
                            <div id="subModalBtnBox">
                                <span onclick="modifyOrder()">저장</span>
                                <span onclick="deleteOrder()">삭제</span>
                                <span onclick="closeModal()">닫기</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </form>
            </div>

{% endblock content %}